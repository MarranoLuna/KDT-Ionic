<ion-header>
  <ion-toolbar color="warning"> <ion-buttons slot="start">
      <ion-back-button defaultHref="/kdt-home" text=""></ion-back-button>
    </ion-buttons>
    <ion-title>Mis ganancias</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>

  <ion-segment 
    (ionChange)="onFilterChange($event)" 
    [value]="currentFilter"
    class="ion-padding-horizontal">
    
    <ion-segment-button value="today">
      <ion-label>Hoy</ion-label>
    </ion-segment-button>
    <ion-segment-button value="total">
      <ion-label>Total</ion-label>
    </ion-segment-button>
  </ion-segment>

  <div *ngIf="isLoading" class="ion-text-center ion-padding-top">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Calculando tus ganancias...</p>
  </div>

  <div *ngIf="!isLoading">
    
    <ion-card class="total-earnings-card ion-margin-horizontal">
      <ion-card-content class="ion-text-center">
        <ion-label>
          <p>{{ currentFilter === 'today' ? 'Ganancias de Hoy' : 'Ganancias Totales' }}</p>
          <h1>{{ totalEarnings | currency:'ARS':'symbol' }}</h1>
        </ion-label>
      </ion-card-content>
    </ion-card>
    
    <ion-item lines="none" class="ion-padding-horizontal">
      <ion-label>
        <h2>Desglose de Pedidos</h2>
      </ion-label>
    </ion-item>

    <div *ngIf="completedOrders.length === 0" class="ion-text-center ion-padding">
      <p>{{ currentFilter === 'today' ? 'No tienes pedidos completados hoy.' : 'No tienes pedidos en tu historial.' }}</p>
    </div>

    <ion-list *ngIf="completedOrders.length > 0" lines="full" class="ion-padding-horizontal">
      <ion-item *ngFor="let order of completedOrders">
        <ion-label>
          <h3>{{ order.offer.request?.title || ('Pedido #' + order.id) }}</h3>
          <p>{{ order.updated_at | date:'dd/MM/yyyy HH:mm' }}</p>
        </ion-label>
        <span slot="end" class="earning-amount">+ {{ order.offer.price | currency:'ARS':'symbol' }}</span>
      </ion-item>
    </ion-list>

  </div>

</ion-content>