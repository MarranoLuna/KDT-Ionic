<ion-header>
  <ion-toolbar color="warning">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home" text=""></ion-back-button>
    </ion-buttons>
    <ion-title>Solicitudes</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <div *ngIf="isLoading" class="ion-text-center">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Cargando solicitudes...</p>
  </div>

  <div *ngIf="!isLoading && requests.length === 0" class="ion-text-center">
    <p>No tienes solicitudes activas.</p>
  </div>
  
  <ion-card *ngFor="let request of requests">
    <ion-card-header>
      <ion-card-title>
        Solicitud #{{ request.id }}
      </ion-card-title>
      <ion-card-subtitle color="success" class="ion-text-end">{{ request.status?.name }}</ion-card-subtitle>
    </ion-card-header>

    <ion-card-content>
      <p>{{ request.description | slice:0:40 }}...</p>

      <div class="ion-text-end" style="margin-top: 5px;">
        <a (click)="toggleDetail(request.id)">
          {{ expandedId === request.id ? 'Ocultar' : 'Ver detalles' }}
          </a>
      </div>

      <div *ngIf="expandedId === request.id" class="detalle">
        <ion-list lines="none">

  <ion-item>
    <ion-label position="stacked"><strong>Descripci√≥n</strong></ion-label>
    <ion-textarea *ngIf="editingId === request.id" [(ngModel)]="editableRequest.description" autoGrow></ion-textarea>
    <p *ngIf="editingId !== request.id">{{ request.description }}</p>
  </ion-item>

  <ion-item>
  <ion-label position="stacked"><strong>Origen</strong></ion-label>
  <ion-input
    *ngIf="editingId === request.id"
    #editingOriginInput [(ngModel)]="editableRequest.origin_address.address"
  ></ion-input>
  <p *ngIf="editingId !== request.id">{{ request.origin_address?.address  }}</p>
</ion-item>

<ion-item>
  <ion-label position="stacked"><strong>Destino</strong></ion-label>
  <ion-input
    *ngIf="editingId === request.id"
    #editingDestinationInput [(ngModel)]="editableRequest.destination_address.address"
  ></ion-input>
  <p *ngIf="editingId !== request.id">{{ request.destination_address?.address  }}</p>
</ion-item>

  <ion-item *ngIf="editableRequest.amount || request.amount">
    <ion-label position="stacked"><strong>Monto que necesita el cadete</strong></ion-label>
    <ion-input *ngIf="editingId === request.id" [(ngModel)]="editableRequest.amount" type="number"></ion-input>
    <p *ngIf="editingId !== request.id">{{ request.amount | currency:'$' }}</p>
  </ion-item>
</ion-list>

<div class="botones-container">
  <ng-container *ngIf="editingId !== request.id">
    <ion-button fill="clear" color="primary" (click)="startEditing(request)">Editar</ion-button>
    <ion-button fill="clear" color="danger" (click)="confirmDelete(request)">Eliminar</ion-button>
  </ng-container>

  <ng-container *ngIf="editingId === request.id">
    <ion-button fill="solid" color="success" (click)="saveChanges()">Guardar</ion-button>
    <ion-button fill="outline" color="medium" (click)="cancelEditing()">Cancelar</ion-button>
  </ng-container>
</div>
      </div>
    </ion-card-content>
  </ion-card>
</ion-content>